<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Change Password | JobberMed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/supabase.js"></script>
  <script src="js/savedJobs.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="auth-body">
  <div class="top-strip"></div>

  <a class="auth-back" href="dashboard.html">‚Üê Back to Dashboard</a>

  <main class="auth-wrap">
    <section class="auth-card">
      <img src="images/signin.png" alt="JobberMed" class="auth-logo" />
      <h1 class="auth-title">Change Password</h1>

      <form class="auth-form" id="passwordForm">
        <label class="auth-label" for="newPassword">New password</label>
        <input id="newPassword" class="auth-input" type="password" placeholder="Enter new password" required />

        <label class="auth-label" for="confirmNewPassword">Confirm password</label>
        <input id="confirmNewPassword" class="auth-input" type="password" placeholder="Confirm new password" required />

        <button type="submit" class="auth-submit" id="submit-btn">Update password</button>
        <div id="passwordMessage" class="auth-message" role="status"></div>
      </form>
    </section>
  </main>

  <footer class="footer-strip" aria-label="Footer">
    <div class="footer-inner">
      <a href="./" class="footer-link">Home</a>
      <a href="dashboard.html" class="footer-link">Dashboard</a>
      <a href="about.html" class="footer-link">About Us</a>
      <a href="privacy.html" class="footer-link">Privacy Policy</a>
      <a href="subscribe.html" class="footer-link">Subscribe to Newsletter</a>
      <a href="signup.html" class="footer-link">Sign Up</a>
    </div>
  </footer>

  <script>
    (async () => {
      if (typeof supabase === "undefined") return;
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        window.location.href = "signin.html";
        return;
      }

      const form = document.getElementById("passwordForm");
      const message = document.getElementById("passwordMessage");

      const showMessage = (text, isError = false) => {
        message.textContent = text;
        message.classList.toggle("auth-error", isError);
        message.classList.toggle("auth-success", !isError);
      };

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const newPassword = document.getElementById("newPassword").value;
        const confirmPassword = document.getElementById("confirmNewPassword").value;

        if (newPassword.length < 6) {
          showMessage("Password must be at least 6 characters", true);
          return;
        }
        if (newPassword !== confirmPassword) {
          showMessage("Passwords do not match", true);
          return;
        }

        const { error } = await supabase.auth.updateUser({ password: newPassword });
        if (error) {
          showMessage(error.message, true);
          return;
        }
        showMessage("Password updated");
        form.reset();
      });
    })();
  </script>
</body>
</html>
